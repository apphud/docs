Apphud позволяет отправлять события о подписках в различные сторонние приложения: системы мобильной аналитики и мессенджеры.

Список доступных на текущий момент интеграций:

* Amplitude;
* Mixpanel;
* Slack;
* Telegram.

> Этот список постоянно расширяется. Если вы хотите запросить интеграцию с каким-то другим сервисом, пожалуйста, напишите нам на [email](mailto:hi@apphud.com).
>

## Параметры событий

Вместе с некоторыми событиями отправляются дополнительные параметры. Вот их полный перечень с описаниями:

| Параметр            | Описание                                                     |
| :------------------ | ------------------------------------------------------------ |
| `product_id`        | Идентификатор продукта                                       |
| `transaction_id`    | Идентификатор транзакции                                     |
| `unit`              | Единица измерения длительности триала или вводного предложения. Возможные значения: `day`, `week`, `month`, `year` |
| `units_count`       | Число `unit`-ов в длительности триала или вводного предложения: так, для двух недель это значение будет равно двум |
| `local_price`       | Цена покупки в валюте пользователя                           |
| `currency`          | Код валюты пользователя                                      |
| `usd_price`         | Цена покупки в долларах США                                  |
| `price_description` | Описание цены в формате: `local_price` `currency` ~ `usd_price`, например: 499 RUR ~ 7.8 USD |
| `reason`            | Причина отмены подписки, если это – событие окончания триала, вводного предложения или подписки. Возможные значения: `user_canceled`, `billing_issue`, `declined_price_increase`, `unavailable_product`, `unknown_error`<br/><br/>Причина возврата денег, если это – событие возврата денег. Возможные значения: `app_issue`, `another_reason` |
| `offer_type`        | Тип вводного или промо-предложения. Возможные значения: `pay_up_front`, `pay_as_you_go`, `trial` (для промо-предложений) |
| `app_name`          | Название приложения                                          |
| `user_id`           | Идентификатор пользователя                                   |
| `group_name`        | Название группы покупок                                      |

Типы значений, которые принимают каждый параметр – строковый, логический и прочие – варьируются в зависимости от конкретной интеграции. Чтобы узнать больше, просмотрите документацию по нужной интеграции.

### Возможные значения `reason`

Параметр `reason` может принимать одно из следующих значений:

#### Если это – событие окончания триала, вводного предложения или подписки

* `user_canceled`: пользователь отменил подписку через приложение "Настройки" или "App Store";
* `billing_issue`: возникла ошибка при попытке списания денежных средств с пользователя;
* `declined_price_increase`: пользователь не согласился с повышением цены на подписку;
* `unavailable_product`: продукт (подписка) оказался недоступен при попытке продления;
* `unknown_error`: произошла другая ошибка.

#### Если это – событие возврата денег

* `app_issue`: у вашего приложения имеется какая-то проблема;
* `another_reason`: другая причина, например, пользователь совершил покупку случайно.

## Свойства пользователя

Кроме событий Apphud в некоторых интеграциях отправляет информацию о пользователе. В таблице ниже указано описание возможных свойств пользователя:

| Свойство                                                     | Описание                                                     |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| `[Apphud] status-<group_name>`, где `<group_name>` – наименование группы продуктов (подписок) | Статус подписки для этой группы подписок. Возможные значения: `none`, `trial`, `intro`, `regular`, `promo`, `refunded`, `expired` |
| `[Apphud] autorenew-<group_name>`, где `<group_name>` – наименование группы продуктов (подписок) | Включено ли автоматическое возобновление для этой группы подписок |
| `[Apphud] total_spent`                                       | Общая сумма покупок пользователя до вычета комиссии Apple в долларах США |
| `[Apphud] paying`                                            | Является пользователь платящим или нет                       |
| `[Apphud] payments_count`                                    | Общее число платежей пользователя                            |

Тип значений, которые принимают каждое свойство – строковый, логический и прочие – варьируются в зависимости от конкретной интеграции. Чтобы узнать больше, просмотрите документацию по нужной интеграции.

### Возможные значения `[Apphud] status-<group_name>`

Свойство `[Apphud] status-<group_name>` может принимать одно из следующих значений:

* `none`: у пользователя нет и никогда не было активной подписки в этой группе подписок;
* `trial`: у пользователя есть активный триал в этой группе подписок;
* `intro`: у пользователя есть активное вводное предложение в этой группе подписок;
* `promo`: у пользователя есть активное промо-предложение в этой группе подписок;
* `regular`: у пользователя есть активная подписка в этой группе подписок;
* `refunded`: пользователь вернул деньги за подписку в этой группе подписок;
* `expired`: подписка или триал пользователя истек в этой группе подписок.