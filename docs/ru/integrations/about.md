# Интеграции

Apphud позволяет отправлять события о подписках в различные сторонние приложения: системы мобильной аналитики и мессенджеры.

Список доступных на данный момент интеграций:

* Amplitude
* Slack
* Telegram

Этот список постоянно расширяется. Если вы хотите запросить интеграцию с каким-то другим сервисом, пожалуйста, напишите нам на [email](mailto:hi@apphud.com).

## Параметры событий

Вместе с некоторыми событиями отправляются дополнительные параметры. Вот их полный перечень:

| Параметр         | Описание                                                     |
| ---------------- | ------------------------------------------------------------ |
| `product_id`     | Идентификатор продукта                                       |
| `transaction_id` | Идентификатор транзакции                                     |
| `unit`           | Единица измерения длительности триала: день, неделя, месяц или год |
| `units_count`    | Количество `unit`-ов в длительности триала: так, для двух недель это значение будет равно двум |
| `local_price`    | Цена покупки в валюте пользователя                           |
| `currency`       | Код валюты пользователя                                      |
| `usd_price`      | Цена покупки в долларах США                                  |
| `in_intro`       | Находится ли пользователь в рамках вводного предложения      |
| `reason`         | Причина отмены подписки. Возможные значения: `user_canceled`, `billing_issue`, `declined_price_increase`, `unavailable_product`, `unknown_error` |
| `refund_reason`  | Причина возврата денег. Возможные значения: `app_issue`, `another_reason` |

Тип значений, которые принимают каждый параметр – строковый, логический и прочие – варьируются в зависимости от конкретной интеграции. Чтобы узнать больше, просмотрите документацию по нужной интеграции.

### Возможные значения `reason`

Параметр `reason` может принимать одно из следующих значений:

* `user_canceled`: пользователь отменил подписку через приложение "Настройки" или "App Store";
* `billing_issue`: возникла ошибка при попытке списания денежных средств с пользователя;
* `declined_price_increase`: пользователь не согласился с повышением цены на подписку;
* `unavailable_product`: продукт (подписка) оказался недоступен при попытке продления;
* `unknown_error`: произошла другая ошибка.

### Возможные значения `refund_reason`

Параметр `refund_reason` может принимать одно из двух значений:

* `app_issue`: у вашего приложения имеется какая-то проблема;
* `another_reason`: другая причина, например, пользователь совершил покупку случайно.

## Свойства пользователя

В некоторых интеграциях Apphud кроме событий также отправляет информацию о пользователе. В таблице ниже указано описание возможных свойств пользователя:

| Свойство                                                     | Описание                                                     |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| `[Apphud] state-group_name`, где `group_name` – наименование группы продуктов (подписок) | Статус подписки для этой группы подписок. Возможные значения: `none`, `trial`, `intro`, `regular`, `refunded`, `expired` |
| `[Apphud] autorenew-group_name`, где `group_name` – наименование группы продуктов (подписок) | Статус автоматического возобновления для этой группы подписок. |
| `[Apphud] total_spent`                                       | Общая сумма покупок пользователя до вычета комиссии Apple в долларах США |
| `[Apphud] paying`                                            | Означает, является пользователь платящим или нет             |

Тип значений, которые принимают каждое свойство – строковый, логический и прочие – варьируются в зависимости от конкретной интеграции. Чтобы узнать больше, просмотрите документацию по нужной интеграции.

### Возможные значения `[Apphud] state-group_name`

Свойство `[Apphud] state-group_name` может принимать одно из следующих значений:

* `none`: у пользователя нет и никогда не было активной подписки в этой группе подписок;
* `trial`: у пользователя есть активный триал в этой группе подписок;
* `intro`: у пользователя есть активное вводное предложение в этой группе подписок;
* `regular`: у пользователя есть активная подписка в этой группе подписок;
* `refunded`: пользователь вернул деньги за подписку в этой группе подписок;
* `expired`: подписка или триал пользователя истек в этой группе подписок.